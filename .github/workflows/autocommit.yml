name: Auto Commit

on:
  push:
    branches:
      - update-autocommit

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
      with:
        ref: update-autocommit
        fetch-depth: 0

    - name: Set up Git
      run: |
        git config user.name "Auto Commit Bot"
        git config user.email "bot@example.com"

    - name: Check and commit unfinished changes
      run: |
        if git diff-index --quiet HEAD --; then
          echo "No changes to commit"
        else
          git add -A
          git reset .backups/
          git commit -m "Auto-commit: Unfinished changes" -m "Changes description:\n- Automated cleanup of unfinished changes" || echo "No changes to commit"
        fi

    - name: Check for incomplete commits
      run: |
        if git status --porcelain | grep -q '^??'; then
          git add -A
          git reset .backups/
          git commit -m "Auto-commit: Add untracked files" -m "Changes description:\n- Adding previously untracked files" || echo "No untracked files to commit"
        fi

    - name: Push changes
      run: git push || echo "No changes to push"